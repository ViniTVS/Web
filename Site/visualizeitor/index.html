<!doctype html>
<html lang="pt_BR">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap import -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
    crossorigin="anonymous"></script>
  <!-- Tema Minty do Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootswatch@5.2.3/dist/minty/bootstrap.min.css" rel="stylesheet">

  <link rel="stylesheet" href="../styles.css">

  <title>Visualizeitor</title>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
  <!--  <script type="text/javascript" src="Canvas.js"></script> -->
  <script type="text/javascript" src="Alunos.js"></script>
  <script type="text/javascript" src="Materias.js"></script>
  <script type="text/javascript" src="utils.js"></script>


</head>

<body class="container-fluid" oncontextmenu="return false;">
  <main class="row" style="height: 100vh;">
    <!-- Menu lateral esquerdo -->
    <aside class="col-6 col-sm-4 col-lg-3 col-4 text-center bg-dark p-0 m-0">
      <div class="d-flex flex-column mx-4 justify-content-between py-2" id="nav">
        <!-- Não consigo deixar o gif proporcional sem deixar dentro de uma div :( -->
        <div id="bongo_cat"><img alt="Bongocat" src="../bongo_cat.gif" /></div>
        <nav class="nav nav-pills flex-column">
          <a class="flex-sm-fill text-sm-center nav-link" href="../index.html"> Principal
          </a>
          <a class="flex-sm-fill text-sm-center nav-link" href="../redes2.html">
            Trabalho de redes 2 </a>
          <a class="flex-sm-fill text-sm-center nav-link" href="../banco_de_dados.html"> Banco de Dados usando
            ActiveRecord</a>
          <a class="flex-sm-fill text-sm-center nav-link" href="../processador_de_retas/index.html">
            Processador de retas e polígonos</a>
          <a class="flex-sm-fill text-sm-center nav-link active" aria-current="true" href="visualizeitor/index.html">
            Visualizeitor </a>
          <a class="flex-sm-fill text-sm-center nav-link disabled"> Aplicação Rails </a>
          <a class="flex-sm-fill text-sm-center nav-link" href="../contato.html">
            Contato
          </a>
        </nav>

        <footer style="font-size: 0.8rem;">
          Projetado e desenvolvido por Vinícius Teixeira Vieira dos Santos
        </footer>
      </div>
    </aside>



    <!-- Conteúdo principal (direita) -->
    <section class="col" style="max-height: 100vh; overflow: auto; margin: auto; width: 100%;"
      oncontextmenu="return false;">
      <h1>Visualizeitor</h1>
      <!-- upload de arquivo -->
      <form id="upload-arquivo" method=POST enctype="multipart/form-data">
        <label for="arquivo">Selecionar arquivo de alunos </label>
        <input id="arquivo" name="arquivo" type="file" accept=".xml" />
        <input type="submit" class="btn btn-primary" value="Carregar" />
        <!-- Seletor -->
      </form>
      <label>Selecionar aluno:
        <input disabled list="alunosList" name="myBrowser" id="alunosInput"/></label>
      <datalist id="alunosList">
      </datalist>

      <h2>Obrigatórias</h2>
      <table class="d-none d-sm-block table table-bordered border-primary">
        <thead>
          <tr>
            <th>1º</th>
            <th>2º</th>
            <th>3º</th>
            <th>4º</th>
            <th>5º</th>
            <th>6º</th>
            <th>7º</th>
            <th>8º</th>
          </tr>
        </thead>
        <tbody id="obrigatorias">
        </tbody>
      </table>


      <h2>Outras Disciplinas</h2>
      <table class="d-none d-sm-block table table-bordered border-primary">
        <tbody id="outras">
        </tbody>
      </table>

      <p>
      <h2>Objetivo</h2>
      Criar um aplicativo em html/javascript/jquery, que permita a visualização da grade curricular de alunos de
      qualquer curso. A "prova de conceito" será feita como no curso do BCC.
      <h2>Características</h2>
      <ul>
        <li>Deve conter um desenho da grade curricular do curso (em linhas e colunas).</li>
        <li>Cada disciplina deve estar pintada com uma cor indicando a situação da última matrícula do aluno (aprovado
          em verde, reprovado em vermelho, matriculado em azul, equivalência em amarelo e não cursado em branco).
        </li>
        <li>
          As ações do usuário em cada "caixinha" de uma disciplina, são:
          <ul>
            <li>
              Ao clicar com o botão esquerdo, aparece uma janela popup com os campos "Código/nome da disciplina",
              "última vez cursada" (ano/semestre), "nota" e "frequência". Os dados são da última vez que cursou a
              disciplina
            </li>
            <li>
              Quando o usuário clicar no botão direito, deve aparecer todo o histórico do aluno *naquela disciplina* (ou
              seja, todas as vezes que cursou, com nota, frequência e ano/semestre).
            </li>
          </ul>
        </li>
        <li>
          Na parte superior, deverá haver um campo para que o usuário possa digitar o RA do aluno cujo histórico queira
          ver.
        </li>
        <li>
          Para este trabalho, serão usados os arquivos:
          <ul>
            <li>
              <a href="./alunos.xml" target="_blank" download="alunos">alunos.xml</a>
              que contém os dados fictícios de 12 alunos do curso.
            </li>
            <li>
              <a href="./alunos.xsd" target="_blank" download>alunos.xsd</a>
            </li>
            <li>
              Grade curricular de 1998 ou 2011
            </li>
          </ul>
        </li>
      </ul>
      <h2>Decisões de design</h2>
      Como a grade curricular de 1998 não está disponível no site do curso, será utilizada somente a
      <a href="https://web.inf.ufpr.br/bcc/curriculo/grade-curricular-2011/" target="_blank" rel="noreferrer">grade
        curricular de 2011</a>.
      Quaisquer disciplinas que não estiverem lá presentes serão adicionadas em "Outras Disciplinas".
      </p>

      <!-- Modal -->
      <div class="modal fade" id="modalMateria" tabindex="-1" aria-labelledby="modalMateriaLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content" style="max-height: 80vh; overflow: auto;">
            <div class="modal-header">
              <h1 class="modal-title fs-5" id="modal-title">Modal title</h1>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="modal-body">
              ...
            </div>
          </div>
        </div>
      </div>

    </section>
  </main>
</body>

</html>

<style>
  /* ------------------- tabela ------------------------ */

  table tr td {
    color: black;
    text-align: center;
    min-width: 80px !important;
  }

  table th {
    text-align: center;
    background-color: var(--bs-primary) !important;
    color: white;
  }

  table{
    margin: auto; 
    margin-bottom: 20px;
	max-width: auto;
  }

  .aprovado {
    color: white;
    background-color: green !important;
  }

  .reprovado {
    color: white;
    background-color: red !important;
  }

  .matriculado {
    color: white;
    background-color: blue !important;
  }

  .equivalencia {
    color: black;
    background-color: yellow !important;
  }

  .trancamento {
    color: white;
    background-color: black !important;
  }

  .celula {
    cursor: pointer;
  }
</style>

<script type="text/javascript">

  const ALUNOS = new Alunos();
  const OBRIGATORIAS = $("#obrigatorias");
  const OUTRAS = $("#outras");
  const LISTA_ALUNOS = $("#alunosList");
  var MATERIAS = {};
  var INPUT_ALUNOS = $("#alunosInput");

  INPUT_ALUNOS[0].disabled = true;
  INPUT_ALUNOS[0].value="Carregue um arquivo";

  desenhaGrade(OBRIGATORIAS, OUTRAS);
  atualizaSeletor(LISTA_ALUNOS, ALUNOS);

  // lê arquivo
  $("#upload-arquivo").submit(function (e) {
    e.preventDefault();
    var file = document.getElementById("arquivo").files[0];
    if (!file) return;
    leArquivo(file, LISTA_ALUNOS, ALUNOS);
    INPUT_ALUNOS[0].disabled = false;
    INPUT_ALUNOS[0].value = "";
  });


  // Atualiza a grade de matérias quando selecionado um GRR
  INPUT_ALUNOS.on('input',function (e) {
    const grr = e.currentTarget.value;
    if (grr == "")
      return;

    let aluno = ALUNOS.getAluno(grr)
    if(aluno){
      MATERIAS = aluno["materias"];
    } else {
      MATERIAS = null;
    }
    desenhaGrade(OBRIGATORIAS, OUTRAS, MATERIAS);
    adicionaMouseEvent();
  });
  // Adiciona evento do mouse para cada célula da tabela de disciplina cursada
  function adicionaMouseEvent() {
    const celulas = document.getElementsByClassName("celula");

    for (const cel of celulas) {
      cel.addEventListener("mousedown", function (e) {
        let classe = e.originalTarget.classList[0];
        let id = e.originalTarget.id;
        let modal = $("#modal-body");
        let titulo = $("#modal-title");

        if (e.buttons == 1) {
          geraModal(modal, titulo, MATERIAS, classe, id, false);
        } else if (e.buttons == 2) {
          geraModal(modal, titulo, MATERIAS, classe, id, true);
        }

        $("#modalMateria").modal('toggle');
      });
    }
  }
</script>
